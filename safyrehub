-- SafyreHub - Fluent UI (FUNCIONANDO)
-- Refeito por ChatGPT (KingScripts01 base)

-- Servi√ßos
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Carregar Fluent UI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/raw/master/src/Fluent.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Criar janela
local Window = Fluent:CreateWindow({
    Title = "SafyreHub " .. Fluent.Version,
    SubTitle = "Westbound",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.RightControl
})

-- Criar abas
local Tabs = {
    Combat = Window:AddTab({ Title = "Combat", Icon = "target" }),
    Visual = Window:AddTab({ Title = "Visual", Icon = "eye" }),
    Player = Window:AddTab({ Title = "Player", Icon = "user" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- Vari√°veis globais
local AimlockEnabled = false
local ESPEnabled = false
local ESPInstances = {}

_G.AimSmoothness = 0.5
_G.AimFOV = 100
_G.ESPColor = "Red"
_G.SpeedEnabled = false
_G.WalkSpeed = 16
_G.HighJump = false

-- Fun√ß√µes auxiliares
local function IsPlayerValid(player)
    return player
        and player.Character
        and player.Character:FindFirstChild("Humanoid")
        and player.Character.Humanoid.Health > 0
end

local function UpdateESP()
    -- Limpar ESP existente
    for _, esp in pairs(ESPInstances) do
        if esp then esp:Destroy() end
    end
    ESPInstances = {}

    if not ESPEnabled then return end

    -- Map de cores
    local colorMap = {
        Red = Color3.fromRGB(255, 0, 0),
        Green = Color3.fromRGB(0, 255, 0),
        Blue = Color3.fromRGB(0, 0, 255),
        Yellow = Color3.fromRGB(255, 255, 0),
        Purple = Color3.fromRGB(128, 0, 128)
    }

    -- Criar novo ESP
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and IsPlayerValid(player) then
            local highlight = Instance.new("Highlight")
            highlight.Adornee = player.Character
            highlight.FillTransparency = 0.5
            highlight.OutlineTransparency = 0
            highlight.FillColor = colorMap[_G.ESPColor] or Color3.fromRGB(255, 0, 0)
            highlight.OutlineColor = highlight.FillColor
            highlight.Parent = player.Character
            ESPInstances[player] = highlight
        end
    end
end

-- ========================
-- üî´ ABA COMBATE
-- ========================
Tabs.Combat:AddParagraph({ Title = "Aim Assist", Content = "Settings for aim assistance" })

Tabs.Combat:AddToggle("AimlockToggle", {
    Title = "Enable Aimlock",
    Default = false,
    Callback = function(Value)
        AimlockEnabled = Value
        Fluent:Notify({
            Title = "Aimlock",
            Content = Value and "Aimlock enabled" or "Aimlock disabled",
            Duration = 3
        })
    end
})

Tabs.Combat:AddSlider("AimSmoothness", {
    Title = "Smoothness",
    Default = 50,
    Min = 1,
    Max = 100,
    Rounding = 1,
    Callback = function(Value)
        _G.AimSmoothness = Value / 100
    end
})

Tabs.Combat:AddSlider("AimFOV", {
    Title = "Field of View",
    Default = 100,
    Min = 10,
    Max = 500,
    Rounding = 1,
    Callback = function(Value)
        _G.AimFOV = Value
    end
})

-- ========================
-- üëÅÔ∏è ABA VISUAL
-- ========================
Tabs.Visual:AddParagraph({ Title = "Visual Enhancements", Content = "ESP and visual features" })

Tabs.Visual:AddToggle("ESPToggle", {
    Title = "Player ESP",
    Default = false,
    Callback = function(Value)
        ESPEnabled = Value
        Fluent:Notify({
            Title = "ESP",
            Content = Value and "ESP enabled" or "ESP disabled",
            Duration = 3
        })
        UpdateESP()
    end
})

Tabs.Visual:AddDropdown("ESPColor", {
    Title = "ESP Color",
    Default = "Red",
    Values = {"Red", "Green", "Blue", "Yellow", "Purple"},
    Callback = function(Value)
        _G.ESPColor = Value
        if ESPEnabled then UpdateESP() end
    end
})

-- ========================
-- üèÉ ABA PLAYER
-- ========================
Tabs.Player:AddParagraph({ Title = "Player Modifications", Content = "Enhance your character" })

Tabs.Player:AddToggle("SpeedToggle", {
    Title = "Speed Hack",
    Default = false,
    Callback = function(Value)
        _G.SpeedEnabled = Value
    end
})

Tabs.Player:AddSlider("WalkSpeed", {
    Title = "Walk Speed",
    Default = 16,
    Min = 16,
    Max = 100,
    Rounding = 1,
    Callback = function(Value)
        _G.WalkSpeed = Value
    end
})

Tabs.Player:AddToggle("JumpToggle", {
    Title = "High Jump",
    Default = false,
    Callback = function(Value)
        _G.HighJump = Value
    end
})

-- ========================
-- ‚öôÔ∏è ABA CONFIGURA√á√ïES
-- ========================
Tabs.Settings:AddParagraph({ Title = "Configuration", Content = "Settings and preferences" })

Tabs.Settings:AddButton({
    Title = "Save Configuration",
    Callback = function()
        SaveManager:Save()
        Fluent:Notify({ Title = "Settings Saved", Content = "Your settings have been saved!", Duration = 3 })
    end
})

Tabs.Settings:AddButton({
    Title = "Load Configuration",
    Callback = function()
        SaveManager:Load()
        Fluent:Notify({ Title = "Settings Loaded", Content = "Your settings have been loaded!", Duration = 3 })
    end
})

Tabs.Settings:AddKeybind("ToggleKeybind", {
    Title = "Menu Toggle Key",
    Mode = "Toggle",
    Default = Enum.KeyCode.RightControl,
    Callback = function() end
})

-- ========================
-- üîÑ LOOPS
-- ========================
-- Aimlock loop
task.spawn(function()
    while task.wait() do
        if AimlockEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
            local closestPlayer, closestDistance
            closestDistance = _G.AimFOV or 100

            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and IsPlayerValid(player) then
                    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        local screenPoint = workspace.CurrentCamera:WorldToViewportPoint(hrp.Position)
                        local mousePos = UserInputService:GetMouseLocation()
                        local distance = (Vector2.new(screenPoint.X, screenPoint.Y) - mousePos).Magnitude

                        if distance < closestDistance and screenPoint.Z > 0 then
                            closestDistance = distance
                            closestPlayer = player
                        end
                    end
                end
            end

            if closestPlayer and closestPlayer.Character:FindFirstChild("Head") then
                local head = closestPlayer.Character.Head
                local camera = workspace.CurrentCamera
                camera.CFrame = camera.CFrame:Lerp(
                    CFrame.new(camera.CFrame.Position, head.Position),
                    _G.AimSmoothness
                )
            end
        end
    end
end)

-- Speed loop
task.spawn(function()
    while task.wait(0.1) do
        if _G.SpeedEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = _G.WalkSpeed
        end
    end
end)

-- Jump loop
task.spawn(function()
    while task.wait(0.1) do
        if _G.HighJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = 100
        end
    end
end)

-- ESP atualiza√ß√£o em novos players
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if ESPEnabled then task.wait(1) UpdateESP() end
    end)
end)

for _, player in ipairs(Players:GetPlayers()) do
    player.CharacterAdded:Connect(function()
        if ESPEnabled then task.wait(1) UpdateESP() end
    end)
end

-- Configurar SaveManager e InterfaceManager
SaveManager:SetLibrary(Fluent)
SaveManager:SetFolder("SafyreHub_Westbound")
SaveManager:BuildConfigSection(Tabs.Settings)

InterfaceManager:SetLibrary(Fluent)
InterfaceManager:BuildInterfaceSection(Tabs.Settings)

-- Notifica√ß√£o inicial
Fluent:Notify({
    Title = "SafyreHub Loaded",
    Content = "Welcome to Westbound! Press RightControl to toggle menu.",
    Duration = 5
})

print("‚úÖ SafyreHub carregado com sucesso!")
